#!/bin/bash
# Copyright (c) 2017-2020, Mudita Sp. z.o.o. All rights reserved.
# For licensing, see https://github.com/mudita/MuditaOS/LICENSE.md

#AUTHOR: RadosÅ‚aw Wicik
COMITS=(
 74281e328596b433c482d614663e61fba0e40ba9
 093351d029bdb005ee8755339c53b8291c9282e9
# 2adb2b36edacab4454b7d6127955d7e30a78f484
# 9df2c9c7e4c361de44fc8d2cebdecb37953535c6
# 09fe300d0b6806a0fddd3df85ae9698e4c0fe8f3
# 19d2d1560942c128dc5334dd824b4fe0b3956950
# c8fb5480ed1cc8a484c58a50ee9d3d034aa42968

# 47fb8737cf54e8dbf8cabbcbd5ffb45b1976783b
# c12490fed4f5ecccd306f9d8f6b9503451f55c41
# e48fa0a63d4fb57266c55dd116678655b62c6552
# 649706295660085bb81893ae4f0560f672a89876
# 59c84823e1e76ccae46fb68a5bc929b02e7bf5ab
# 6fa31f96a0d779bdf529e2c3ccaf25bd91c6c288
# 0646b992b0593bcd2035204ab164c7cba8a00f14
# 6278ab831161e21808ad83cfd92cea450673e2bd
# 3601ddee19752d2ea7b5bbe8e6c9eeae54bb31b6
# 2457c4bbb84b778ae9cf40addc97eed3d6ea4e01
# d426404ddfe4d7487c9bf49c1561048a218d6837
# 6b536cf72ee31680c9f42473d720dec7b50adeb4
# 5cc0766d6dbaa5d9c45b35dec8acd61bcd59d6b1
# e0e422c2bda7e9aee8867e631a6a507bba6ec780
# 26415431dafda82b3e26f29081deab54e166ec24
# 581b01a6c28c952204461b708744d58686a6a036
# 0afd03f95115d79bca4db75d0491fcfc7ab00073
# 931bfde8e5c3640490f1852c0fd8b39a27e6d2ae
# c1fe936229c0c5283c9c1176ac46cee18fa338a7
# a449e20b597ba30161127187d14262fcca566ffe
# e1305ffe61155d7c77ab44f8dd8f89a9a64c7ee2
# 3d9e0949340d9bfc4d59022ead0db9d168453819
# 09148488787e6f904fd3bbd17d47b26f157773da
# a424fbeb997da70d2b6d2c84b96c52bb08262226
# c3d0d8b521b0f6bd94c514c65d8553b6ab34c6b3
# 9684d5eebdd19d5b2eb3071b6297c4fca8239a0d
# e3fd0eb71da009525421e8ddb32373046a2e97f6
# 47bcf28c8eed80994873bed4110d5a2e1a8c9878
# bd878ca3d7654d32b35732a890f375e8996d7184
# 5f3ada797b8e86152f2ca8e60edd6f621e2ece18
# 94378c77fc89a171d99707d0a86c313a2b4cf0cc
# 9ac95dc462203891560706539b3b6f237ec4c7f6
# 17757cdf3d6a2cf7afa061a1473aa5a61e1e299d
# 37cb1995c7979d914c53f765ba76d38006aed8b2
# 0bdc633207d838d5ef2bf12fe88ea63283c451cf
# 0d2438db37a38f7a81ef46f2bcdfab799416df58
# 82341fb4d56e6013044ba5581b09109b6ab26f19
# a91ca2a6a41c1c3d15c3b46cdd02972b068a3873
# 1a31caf0d44564cf5191caf504650f43ac71cee1
# 49f4d759970a34a2d4f09e2dd68b536c6f33acd1
# 035aef0f9fe0c7687bd44616273200437d6423d5
# f21c3328cc4a80a99d54d674346845b6061f0de4
# c4a7bfb8c55a76cd16db4680eeb42214171737b0
# 28c023cb27853d9173871837eb3116b51cda68d4
# 3b137f26cb4597fa14b103ccdff8ca7aa3f689da
# 0faa98e6a76373b63d40943c8a17cbbff1c440fc
# a1fa9bf8129aaa678fcb3119c1f65bbed8d71f8c
# 67eac0f931a56e9f75afb80d44e8100e81c6e090
# 937f611590d63caf8f8011ea68a9ea7c02465b80
# d1d9d2946d91302ce87b1b1c9f0f3a39288f5885
# b6f09d26259f89b0d8b675edd177ef9446adff25
# 22d914bd1e7f4c4ed95753b2f313d6920a4768fb
# fdf70bd61e3d8fbfbf307e8a39122c46ca21d77f
# a274541972b7668c330a274eb102084846b6b1c1
# 141390e812aae1357edb58d83db06bce55df88f3
# cf62c870814c1817d8428a5155275c74b8b62956
# a7d55892fd30ee6ba5b6303dc6c62ccb383f3a2f
# 71a7b8366d5097ea02e12e2f110ee0eda790e0fa
# 8991a78722782c6fc6addba748d75ea654c3b649
# e848ce31a1915118b4539523d6d2b51e4336926e
# 8d3720d7e2d2eecf837bb38ee9fc4f542d1771f7
# 5b05b7bf75d36133822e15107e74522784ff44a1
# b6f8a27b5980635e2f1cc319a1d14b9660487bcc
# e0c8ae4946900ecaa077e73ffcb9a0144364ad6d
# 5b34e5254ea9c6b6428128632a2ff93b4ae5a6b9
# b38dc20e90aeccc48f570fa3f132a698f921f9cf
# 1a661f2a5b10cd4ffd184b3c1c5d0828c993421e
# 12d5513bd4277f10ced93944e643b09c1a7215d8
# ddffb2ab593e0d9e2b288fd8a9ef32f92c03cc94
# 362035ddd05b658f9c323eab0686589c2ac51f36
# 42c065e76c88490b891960ce5bb935e678f51a6f
# a36c26407d9ae9f96946962c95437a83075dda90
# 8a463aa7ed60539daedb7127f29355e82bd2fac8
# 508003ffa1c3afd2e433154a1e5e69f2b3cf24aa
# c33a805ed7ce298b0d304ebe4481dca827d8671f
# 7e30be047e32a44fc5601bcff8707b73f410664e
# 11e04962fcad4d115760b95bfee522375bf81a5e
# 1150484b61cbc6a7e3b46c3406765ef0a33e708a
# 848668c7be2a028c25cfd02f653c9983cff0f0f6
# e799186cc6394186679357c17deaa767e54b5d30
# 091e26243a9e3232c25cd1dd08c86191cf60ace4
# 20e045a6d931cce390ae441be7cfecd8aeaf8522
# c6b31a92b7dd6df7fc6b70fbc16486d999702860
# ca9d8bc671dc61f28984eb1fb65d4c8759bab2bc
# 342fe5a740a1ebf587c711343fa122368b7a5c59
# bb47366cd310aa81447074df487921071bfc95cc
# 44cda3ec420a437fb9b03b263110c2aac979716e
# ec11bdefdf0766596941a912e81c5052f5ac558d
# e5d4dfc66e3362c3a1dfbc0cc13e16e7bb789e5e
# 6f7d2012bdfdc9455200864802f99ffc6895d5af
# b82e804f83e5721ac6c180e49f2ed6510556ad00
# 8580239b4c367ae060b799b5aad7c156954c4539
# 03ae32d67d6e251202bfd444f20d8c25a7e8928a
# 022a374265e37018713a573d4eeccac665cce1fd
# a801cb6e143df9e7bcc8bd00c3596762d5415a5a
# 93103112b6180422967951ab30e1728d08c66604
# 8b06caea0afd065ac55a8c433b0f0cda5cacc55f
# 10f493223d4ceac03df8d683e73842c4a5cddbca
# 232dec807f03e317d682a41c3c006759f4143cf5
# 77a5d2cbfee801d37d18b0327a4d259f61ea9cc5
)

COMITS_COUNT=${#COMITS[@]}
BUILD_TYPE="RelWithDebInfo"
BUILD_DIR="build-rt1051-${BUILD_TYPE}"

I=${COMITS_COUNT}
while [[ I -gt 0 ]]
do
    I=$(( I - 1 ))
    COMIT_ID=${COMITS[${I}]}
    echo "$I/${COMITS_COUNT} : ${COMIT_ID}" >> tools/current_commit.txt
    git co ${COMIT_ID}
    git subup
    ./configure.sh rt1051 ${BUILD_TYPE}
    pushd ${BUILD_DIR}
    make -j10
    popd
    if [[ -e ${BUILD_DIR}/PurePhone.elf ]]; then
        USSAGE=$( ./tools/calc_mem_ussage.sh ${BUILD_DIR} )
    else 
        USSAGE="- not build"
    fi
    echo "${COMIT_ID}:${USSAGE}" >> tools/mem_ussage.txt
done
